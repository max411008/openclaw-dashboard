name: ğŸ“Š Update Dashboard Status

on:
  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:
  
  # å®šæ™‚åŸ·è¡Œï¼ˆæ¯ 10 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼‰
  # æ³¨æ„ï¼šé€™å€‹ workflow åœ¨ GitHub ä¼ºæœå™¨ä¸ŠåŸ·è¡Œï¼Œç„¡æ³•è®€å–ä½ çš„ Mac ç‹€æ…‹
  # ä¸»è¦ä½œç‚ºå‚™æ´ï¼Œç¢ºä¿ç¶²ç«™è‡³å°‘æœƒæ›´æ–° timestamp
  schedule:
    - cron: '*/10 * * * *'

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Update timestamp
      run: |
        # è®€å–ç¾æœ‰çš„ status.json
        if [ -f data/status.json ]; then
          # ä½¿ç”¨ jq æ›´æ–° timestampï¼ˆå¦‚æœå®‰è£äº† jqï¼‰
          if command -v jq &> /dev/null; then
            jq --arg date "$(date -u +%Y-%m-%dT%H:%M:%SZ)" '.last_update = $date' data/status.json > tmp.json && mv tmp.json data/status.json
          else
            # ç°¡å–®çš„ sed æ›¿æ›
            sed -i "s/\"last_update\": \"[^\"]*\"/\"last_update\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"/" data/status.json
          fi
        fi
        
    - name: Commit and push
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add data/status.json
        git diff --quiet && git diff --staged --quiet || git commit -m "Update timestamp: $(date)"
        git push
